<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>SekAI - Advanced AI Chatbot & OCR</title>

<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
  /* Reset */
  * {
    box-sizing: border-box;
  }

  body, html {
    margin: 0; padding: 0; height: 100%;
    font-family: 'Inter', sans-serif;
    background: linear-gradient(135deg, #0a1f44, #083e74);
    color: #e9edf5;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  /* Container */
  .container {
    background: #142a54;
    width: 100%;
    max-width: 720px;
    height: 600px;
    border-radius: 20px;
    box-shadow:
      0 8px 20px rgba(0, 0, 0, 0.35),
      inset 0 0 30px rgba(0, 121, 255, 0.3);
    display: flex;
    flex-direction: column;
    overflow: hidden;
    user-select: none;
  }

  /* Header */
  header {
    background: linear-gradient(90deg, #00ffb8, #0088ff);
    color: #0d1b33;
    font-weight: 700;
    font-size: 2.4rem;
    text-align: center;
    padding: 1.8rem 0;
    letter-spacing: 2px;
    box-shadow: 0 3px 10px #00ffb8aa;
  }

  /* Chatbox */
  #chatbox {
    flex: 1;
    background: #0d204a;
    padding: 1.8rem 2rem;
    overflow-y: auto;
    font-size: 1.1rem;
    line-height: 1.5;
    scrollbar-width: thin;
    scrollbar-color: #00ffb8 transparent;
  }

  /* Custom scrollbar for Webkit */
  #chatbox::-webkit-scrollbar {
    width: 8px;
  }
  #chatbox::-webkit-scrollbar-track {
    background: transparent;
  }
  #chatbox::-webkit-scrollbar-thumb {
    background: #00ffb8;
    border-radius: 10px;
  }

  /* Messages */
  .message {
    margin-bottom: 1.6rem;
    opacity: 0;
    transform: translateY(12px);
    animation: fadeSlideIn 0.4s forwards;
    white-space: pre-wrap;
    max-width: 85%;
    border-radius: 15px;
    padding: 0.85rem 1.2rem;
    box-shadow: 0 3px 10px rgb(0 255 184 / 0.3);
  }

  @keyframes fadeSlideIn {
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* User message style */
  .user {
    background: linear-gradient(135deg, #00ffa0, #00cc88);
    align-self: flex-end;
    color: #0d1b33;
    font-weight: 600;
  }

  /* Bot message style */
  .bot {
    background: linear-gradient(135deg, #0055ff, #0088ff);
    color: #e9edf5;
    align-self: flex-start;
    font-weight: 500;
  }

  /* Input area */
  #inputArea {
    background: #083e74;
    padding: 1.2rem 2rem;
    display: flex;
    gap: 1rem;
    align-items: center;
    border-top: 1px solid #0066ff44;
  }

  /* Text input */
  #input {
    flex: 1;
    padding: 0.85rem 1.2rem;
    font-size: 1rem;
    border-radius: 15px;
    border: none;
    font-family: 'Inter', sans-serif;
    transition: box-shadow 0.3s ease;
  }

  #input:focus {
    outline: none;
    box-shadow: 0 0 15px #00ffb8;
  }

  /* Send button */
  button#sendBtn {
    background: #00ffb8;
    border: none;
    border-radius: 15px;
    padding: 0.9rem 1.6rem;
    font-weight: 700;
    font-size: 1rem;
    cursor: pointer;
    color: #0d1b33;
    box-shadow: 0 5px 15px #00ffb8aa;
    transition: background 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  button#sendBtn:hover {
    background: #00d48a;
  }

  /* Send icon */
  button#sendBtn svg {
    width: 20px;
    height: 20px;
    margin-left: 6px;
    fill: #0d1b33;
  }

  /* Image upload input styling */
  #imageInput {
    background: #0055ff;
    padding: 0.65rem 1.1rem;
    border-radius: 15px;
    border: none;
    font-weight: 600;
    font-size: 0.95rem;
    color: #e9edf5;
    cursor: pointer;
    box-shadow: 0 4px 10px #0055ffaa;
    transition: background 0.3s ease;
  }

  #imageInput:hover {
    background: #003ea6;
  }

  #imageInput::-webkit-file-upload-button {
    cursor: pointer;
  }

  /* Responsive */
  @media (max-width: 480px) {
    .container {
      height: 90vh;
      width: 95vw;
      border-radius: 14px;
    }
    header {
      font-size: 1.8rem;
      padding: 1.2rem 0;
    }
    #chatbox {
      padding: 1rem 1.2rem;
      font-size: 1rem;
    }
    #inputArea {
      padding: 1rem 1.2rem;
      gap: 0.6rem;
    }
    #imageInput, button#sendBtn {
      padding: 0.6rem 1rem;
      font-size: 0.85rem;
    }
  }
</style>

</head>
<body>

<div class="container" role="main" aria-label="SekAI chatbot container">
  <header>SekAI - Advanced AI Chatbot & OCR</header>

  <div id="chatbox" role="log" aria-live="polite" aria-relevant="additions"></div>

  <form id="inputArea" aria-label="Message input form" onsubmit="event.preventDefault(); sendMessage();">
    <input id="input" type="text" aria-label="Message input" placeholder="Type your message here..." autocomplete="off" required />
    <button id="sendBtn" type="submit" aria-label="Send message">
      Send
      <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false"><path d="M2 21l21-9L2 3v7l15 2-15 2z"/></svg>
    </button>
    <input type="file" id="imageInput" accept="image/*" aria-label="Upload image to extract text" title="Upload image to extract text" />
  </form>
</div>

<script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.0.2/dist/tesseract.min.js"></script>
<script>
  const chatbox = document.getElementById('chatbox');
  const input = document.getElementById('input');
  const imageInput = document.getElementById('imageInput');

  let lastExtractedText = "";

  const creatorName = "Salmane ELKADDANI";

  const knowledgeBase = [
    { patterns: [/hello/i, /hi/i, /hey/i, /howdy/i, /good morning/i, /good afternoon/i], reply: "Hello! How can I assist you today?" },
    { patterns: [/how are you/i, /how do you do/i], reply: "I'm doing great, thanks for asking! How about you?" },

    { patterns: [
        /who (created|made|developed|is your creator|is your owner)/i,
        /who (is your maker|owns you)/i,
        /من (صنعك|مالك|مطوّرك|مطورك|مالكك|أنشأك)/i,
        /qui t'a créé/i,
        /wer hat dich gemacht/i,
        /chi ti ha creato/i,
        /quién te creó/i,
        /quem te criou/i,
        /кто тебя создал/i,
        /誰があなたを作った/i
      ],
      reply: `My creator is ${creatorName}. / My developer is ${creatorName}. / صانعي هو ${creatorName}. / Mon créateur est ${creatorName}. / Mein Entwickler ist ${creatorName}. / Il mio creatore è ${creatorName}. / Mi creador es ${creatorName}. / Meu criador é ${creatorName}. / Мой создатель - ${creatorName}. / 私の作成者は${creatorName}です。`
    },

    { patterns: [/bye/i, /goodbye/i, /see you/i, /farewell/i], reply: "Goodbye! Have a wonderful day!" },
    { patterns: [/thank you/i, /thanks/i], reply: "You're welcome! Feel free to ask me anything." },

    { patterns: [/how do you work/i, /how do you operate/i], reply: "I analyze your messages with smart rules and can extract text from images you upload." },
    { patterns: [/what do you do/i, /what is your function/i], reply: "I'm here to chat with you and extract text from your uploaded images." },

    { patterns: [/extracted text/i, /text from image/i, /last extracted/i],
      reply: () => lastExtractedText ? `Here is the last extracted text from the image:\n${lastExtractedText}` : "No image text has been extracted yet." },
  ];

  function findBestReply(text) {
    for (const item of knowledgeBase) {
      for (const pattern of item.patterns) {
        if (pattern.test(text)) {
          return typeof item.reply === 'function' ? item.reply() : item.reply;
        }
      }
    }
    const fallback = [
      "Sorry, I didn't quite understand that. Could you please rephrase?",
      "I'm here to help, but I need a bit more information.",
      "Could you clarify your question?",
      "I didn't catch that. Can you ask differently?"
    ];
    return fallback[Math.floor(Math.random() * fallback.length)];
  }

  function appendMessage(role, text) {
    const div = document.createElement('div');
    div.classList.add('message', role);
    div.textContent = (role === 'user' ? "You: " : "SekAI: ") + text;
    chatbox.appendChild(div);
    chatbox.scrollTop = chatbox.scrollHeight;
    // Trigger animation
    div.style.animation = 'none';
    div.offsetHeight; // trigger reflow
    div.style.animation = null;
  }

  function sendMessage() {
    const userText = input.value.trim();
    if (!userText) return;
    appendMessage('user', userText);
    input.value = '';

    setTimeout(() => {
      const reply = findBestReply(userText);
      appendMessage('bot', reply);
    }, 700);
  }

  imageInput.addEventListener('change', () => {
    const file = imageInput.files[0];
    if (!file) return;

    appendMessage('user', `[Image uploaded: ${file.name}]`);
    appendMessage('bot', 'Extracting text from image, please wait...');

    Tesseract.recognize(file, 'eng+ara', {
      logger: m => {
        // Optional: console.log(m);
      }
    }).then(({ data: { text } }) => {
      removeLastBotMessage();
      if (text.trim()) {
        lastExtractedText = text.trim();
        appendMessage('bot', "Text successfully extracted:\n" + lastExtractedText);
      } else {
        appendMessage('bot', "Couldn't extract any text from the image.");
      }
    }).catch(err => {
      removeLastBotMessage();
      appendMessage('bot', "Error occurred while extracting text: " + err.message);
    });

    imageInput.value = "";
  });

  function removeLastBotMessage() {
    const bots = chatbox.querySelectorAll('.bot');
    if (bots.length > 0) {
      chatbox.removeChild(bots[bots.length - 1]);
    }
  }

  input.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
      e.preventDefault();
      sendMessage();
    }
  });
</script>

</body>
</html>
