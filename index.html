<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>بوت دردشة ذكي متعدد اللغات + قراءة نص من صورة</title>
<style>
  body { font-family: Arial, sans-serif; max-width: 700px; margin: 2em auto; background: #fafafa; padding: 1em; }
  #chatbox { border: 1px solid #ddd; background: #fff; padding: 1em; height: 400px; overflow-y: auto; white-space: pre-wrap; }
  .message { margin: 1em 0; }
  .user { color: #1a73e8; }
  .bot { color: #34a853; }
  textarea { width: 100%; height: 90px; margin-top: 1em; resize: none; }
  button { padding: 10px 25px; margin-top: 0.7em; background: #1a73e8; color: white; border: none; border-radius: 4px; cursor: pointer; }
  #imageInput { margin-top: 1em; }
</style>
</head>
<body>

<h2>بوت دردشة ذكي متعدد اللغات + قراءة نص من صورة (OCR)</h2>

<div id="chatbox"></div>

<textarea id="input" placeholder="اكتب رسالتك هنا..."></textarea><br />
<button onclick="sendMessage()">أرسل</button><br />

<label for="imageInput">ارفع صورة لاستخراج النص منها:</label><br />
<input type="file" id="imageInput" accept="image/*" />

<script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.0.2/dist/tesseract.min.js"></script>

<script>
// المتغيرات
const chatbox = document.getElementById('chatbox');
const input = document.getElementById('input');
const imageInput = document.getElementById('imageInput');

// تخزين آخر نص مستخرج من الصور
let lastExtractedText = "";

// عبارة صانع البوت بكل اللغات (نستخدمها للرد على سؤال "من صنعك؟")
const creatorName = "Salmane ELKADDANI";

// قاعدة بيانات متعددة اللغات من الأسئلة والأجوبة مع دعم تعابير منتظمة
const knowledgeBase = [
  // تحيات عامة بأي لغة
  { patterns: [/hello/i, /hi/i, /hey/i, /مرحبا/i, /أهلا/i, /سلام/i], reply: "مرحباً! كيف يمكنني مساعدتك اليوم؟" },
  { patterns: [/how are you/i, /كيف حالك/i, /كيف أنت/i, /how do you do/i], reply: "أنا بخير، شكراً لسؤالك! كيف يمكنني خدمتك؟" },

  // سؤال عن اسم البوت أو صانعه بكل اللغات
  { patterns: [
      /who (created|made|developed|is your creator|is your owner)/i,
      /من (صنعك|مالك|مطوّرك|مطورك|مالكك|أنشأك)/i,
      /qui t'a créé/i,
      /wer hat dich gemacht/i,
      /chi ti ha creato/i,
      /quién te creó/i,
      /quem te criou/i,
      /кто тебя создал/i,
      /誰があなたを作った/i
    ], 
    reply: `My creator is ${creatorName}. / صانعي هو ${creatorName}. / Mon créateur est ${creatorName}. / Mein Entwickler ist ${creatorName}. / Il mio creatore è ${creatorName}. / Mi creador es ${creatorName}. / Meu criador é ${creatorName}. / Мой создатель - ${creatorName}. / 私の作成者は${creatorName}です。`
  },

  // وداع وعبارات شكر متعددة اللغات
  { patterns: [/bye/i, /goodbye/i, /مع السلامة/i, /وداعا/i], reply: "مع السلامة! أتمنى لك يوماً رائعاً." },
  { patterns: [/thank you/i, /thanks/i, /شكراً/i, /متشكر/i], reply: "على الرحب والسعة! أي شيء تحتاجه أنا هنا." },

  // أسئلة عن كيفية عمل البوت
  { patterns: [/how do you work/i, /how do you operate/i, /كيف تعمل/i, /كيف تشتغل/i], reply: "أنا أستخدم قواعد ذكية لتحليل كلامك، وأستطيع قراءة نصوص من الصور." },

  // أسئلة عامة عن وظيفة البوت
  { patterns: [/what do you do/i, /what is your function/i, /ماذا تفعل/i], reply: "أنا هنا لمساعدتك بالدردشة وقراءة نصوص من الصور التي ترفعها." },

  // سؤال عن النص المستخرج من الصور بأي لغة
  { patterns: [/extracted text/i, /النص المستخرج/i, /النص الذي استخرجته/i, /what text/i], 
    reply: () => lastExtractedText ? `النص الأخير من الصورة:\n${lastExtractedText}` : "لم يتم رفع أي صورة لاستخراج النص." },
];

// دالة بحث ذكية بالأنماط مع دعم دوال الردود
function findBestReply(text) {
  for (const item of knowledgeBase) {
    for (const pattern of item.patterns) {
      if (pattern.test(text)) {
        return typeof item.reply === 'function' ? item.reply() : item.reply;
      }
    }
  }
  // ردود عامة إذا ما فهمنا
  const fallback = [
    "عذراً، لم أفهم سؤالك جيداً. هل يمكنك إعادة الصياغة؟",
    "هل يمكنك التوضيح أكثر؟",
    "أنا أحاول مساعدتك، لكن لم أفهم تماماً.",
    "هل يمكنك أن تسأل بطريقة أخرى؟"
  ];
  return fallback[Math.floor(Math.random() * fallback.length)];
}

// إظهار الرسائل في صندوق الدردشة
function appendMessage(role, text) {
  const div = document.createElement('div');
  div.classList.add('message', role);
  div.textContent = (role === 'user' ? "أنت: " : "البوت: ") + text;
  chatbox.appendChild(div);
  chatbox.scrollTop = chatbox.scrollHeight;
}

// إرسال رسالة المستخدم ومعالجة الرد
function sendMessage() {
  const userText = input.value.trim();
  if (!userText) return;
  appendMessage('user', userText);
  input.value = '';

  setTimeout(() => {
    const reply = findBestReply(userText);
    appendMessage('bot', reply);
  }, 600);
}

// رفع صورة وقراءة النص منها (OCR)
imageInput.addEventListener('change', () => {
  const file = imageInput.files[0];
  if (!file) return;

  appendMessage('user', `[صورة مرفوعة: ${file.name}]`);
  appendMessage('bot', 'جارٍ استخراج النص من الصورة...');

  Tesseract.recognize(file, 'ara+eng', { logger: m => console.log(m) })
    .then(({ data: { text } }) => {
      removeLastBotMessage();
      if (text.trim()) {
        lastExtractedText = text.trim();
        appendMessage('bot', "تم استخراج النص بنجاح:\n" + lastExtractedText);
      } else {
        appendMessage('bot', "لم أتمكن من استخراج نص من الصورة.");
      }
    }).catch(err => {
      removeLastBotMessage();
      appendMessage('bot', "حدث خطأ أثناء استخراج النص: " + err.message);
    });

  imageInput.value = "";
});

// إزالة آخر رسالة بوت (لرسالة "جار استخراج النص" المؤقتة)
function removeLastBotMessage() {
  const bots = chatbox.querySelectorAll('.bot');
  if (bots.length > 0) {
    chatbox.removeChild(bots[bots.length - 1]);
  }
}
</script>

</body>
</html>
